OBJECTIVE - 

To demonstrate how Wazuh, integrated with YARA, detects the presence of malicious files on monitored endpoints by scanning files against malware signatures.

SETUP - 

  Wazuh Manager: Server running in VMware
  Agent: Windows 10 host (DESKTOP-GSG0OEO) with YARA installed in the ossec-agent active-response directory
  Monitored Source: Downloads directory (C:\Users\acer\Downloads\) configured for YARA scans
  YARA Rules: Community malware ruleset including the EICAR test signature

ATTACK / SIMULATION STEPS - 

  Malware Simulation:

    The standard EICAR test file (eicar.com) was saved in the monitored Downloads folder.
    This file is harmless but universally recognized by AV engines as a test malware sample.

  Detection:

    Wazuh triggered an active response that invoked YARA to scan the file.
    The rule SUSP_Just_EICAR_RID2C24 matched against the file contents.
    Wazuh generated a high-severity alert (level 12) and logged the detection event.

EVENT DETECTED - 

  Timestamp: Aug 31, 2025 @ 03:17:38.062
  Agent: DESKTOP-GSG0E0 (192.168.1.5)
  Detection Type: Malware detection (YARA scan result)
  Location: c:\users\acer\downloads\eicar.com
  Rule ID: 108001
  Rule Description: File c:\users\acer\downloads\eicar.com is a positive match. YARA rule: SUSP_Just_EICAR_RID2C24
  Alert Level: 12

  Log Extract:

    wazuh-yara: INFO - Scan result: SUSP_Just_EICAR_RID2C24 c:\users\acer\downloads\eicar.com

OBSERVATION - 

  Wazuh successfully integrated YARA scanning into its detection pipeline.
  The file was flagged using a YARA rule match, confirming the integration works as intended.
  The event was classified under the yara rule group.
  The alert was visible in the Wazuh dashboard, providing analysts with full metadata (file path, rule name, severity).

DETECTION USE CASE - 

  MITRE ATT&CK:

    T1204.002 – User Execution: Malicious File (users downloading or executing malware)
    T1105 – Ingress Tool Transfer (malware dropped/downloaded into monitored directory)

  Use Case: By integrating YARA with Wazuh, organizations gain the ability to scan and detect malware at the file level. This allows defenders to identify suspicious executables, trojans, ransomware droppers, or test signatures like EICAR before they are executed, strengthening endpoint protection.
